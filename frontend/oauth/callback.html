<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mcplink - 로그인 처리 중</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="icon" href="../assets/images/logo.ico" type="image/x-icon">
</head>
<body>
    <div class="loading-container">
        <div class="loading-spinner"></div>
        <p>로그인 처리 중입니다...</p>
    </div>

    <script>
        // URL에서 인가 코드 추출
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');

        if (code) {
            // 토큰 요청
            const tokenRequest = {
                grant_type: 'authorization_code',
                client_id: '64da588a-f264-4a90-924c-7cb326bf9d3a',
                client_secret: 'Secret52c55ce6-cb6c-48d4-b17f-433e4178bd9c',
                redirect_uri: `${API_BASE_URL}/api/v1/auth/ssafy/callback`,
                code: code
            };

            fetch('https://project.ssafy.com/ssafy/oauth2/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'
                },
                body: new URLSearchParams(tokenRequest)
            })
            .then(response => response.json())
            .then(data => {
                // 토큰을 받아서 사용자 정보 요청
                return fetch('https://project.ssafy.com/ssafy/resources/userInfo', {
                    headers: {
                        'Authorization': `Bearer ${data.access_token}`,
                        'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'
                    }
                });
            })
            .then(response => response.json())
            .then(userInfo => {
                // 사용자 정보를 로컬 스토리지에 저장
                localStorage.setItem('userInfo', JSON.stringify(userInfo));
                // 메인 페이지로 리다이렉트
                window.location.href = '/';
            })
            .catch(error => {
                console.error('로그인 처리 중 오류 발생:', error);
                alert('로그인 처리 중 오류가 발생했습니다.');
                window.location.href = '/';
            });
        } else {
            console.error('인가 코드를 찾을 수 없습니다.');
            window.location.href = '/';
        }
    </script>
</body>
</html> 